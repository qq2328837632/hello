---
title: c++类
date: 2023-04-24 09:39:59
tags:
---

C++要求对一般的内置函数要用关键字inline声明，但对类内定义的成员函数，可以省略inline，因为**这些成员函数已经被隐含地指定为内置函数了**。

类的隐式内联和显式内联：

- 类内部的内联函数：类内部只要定义在函数其实都是默认inline的（即通常我们说的尽量不要往.h中类定义的地方直接定义函数，最好只是做一个申明，这个说法其实不太好，因为这会破坏隐藏内联的功能）。
- 虽然说即便是隐藏的内联，也不一定是内联的，最后还是编译器决定，但是定义在.cpp中的内容，等于是放弃了内联功能，这种可能性降低的写法其实是不推荐的。
- 另外，也可以用inline放在开头，进行显式的内联，但是仍然需要注意：类内部成员函数的申明和最终的成员函数的定义（可以放在类定义的外部，但是还是要在同一个.h中，否则inline不会生效）。所以，从这个角度看，基本上可以引出一条规定：一些简单的函数、构造函数、析构函数，推荐在类内部进行直接定义，这样能够用到inline功能，对于性能来说更加有利的。至于可读性方面的考虑，完全可以加一些范围的注释、分类，将需要inline的定义在一撮，另外需要在cpp中实现的“复杂”函数，申明在另外一撮。

## C++中常量成员函数

可以将C++中类的成员函数声明为常量，这种成员函数叫做常量成员函数（const member function）。

### 1 声明

将const关键字放在类成员函数的参数列表之后，表示该函数为常量成员函数。

```
class MyClass

{

public:

int consFunc() const;

private:

int m_MyNum;

};
```

### 2 定义

可以在类内定义consFunc()函数，也可以在类外定义。不管是在类内还是类外定义该函数，都要使用关键字const。

```
int MyClass::consFunc() const

{

return this->m_MyNum;

}
```

### 3 含义

在“2定义”中定义的consFunc()函数中，如果不添加const关键字，此时constFunc()是普通的成员函数，此时this的类型是MyClass* const，即this本身是常量，但是其指向的类型是非常量。这就意味着我们不能把this绑定到一个常量对象上。如果要把this绑定到一个常量对象上，必须要把this定义成const MyClass* const，即指向常量的常量。在类成员函数的参数列表之后添加const关键字，就相当于把this定义成const MyClass* const。

### 4 注意事项

#### 4.1 常量对象必须调用常量成员函数

正如“3 含义”中提到的，如果通过常量对象调用类的成员函数，该成员函数必须是常量成员函数。

#### 4.2 非常量对象可以调用常量成员函数

因为可以将一个非常量赋值给常量，所以非常量对象可以调用常量成员函数。

```
MyClass myclass;

myclass.consFunc();
```



#### 4.3 常量成员函数中不能修改成员变量

因为常量成员函数中的this类型是const MyClass* const，所以不能通过this来修改成员变量。

如果consFunc()函数的定义改为如下

```
int MyClass::consFunc() const

{

return this->m_MyNum++;

}
```

则此时程序会报错，error C3490: 由于正在通过常量对象访问“m_MyNum”，因此无法对其进行修改。

------

编译器分两步处理类:首先编译成员的声明，然后才轮到成员函数体（如果有的话)。因此，成员函数体可以随意使用类中的其他成员而无须在意这些成员出现的次序。
